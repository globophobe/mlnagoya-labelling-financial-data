import { Layout, Image, Appear, Fit, Fill, Heading, Link, Table, TableHeader, TableHeaderItem, TableBody, TableRow, TableItem, Text, S } from 'spectacle';
import { DarkSlide, CodeSlide } from './slides';
import arex from '../assets/arex.jpg';
import cover from '../assets/cover.jpg';
import coverJapanese from '../assets/cover-japanese.jpg';
import marcos from '../assets/marcos.jpg';
import bitcoin from '../assets/bitcoin.png';
import fixedHorizon from '../assets/fixed-horizon.png';
import tripleBarrier from '../assets/triple-barrier.png';
import cusum from '../assets/cusum.png';
import volatility from '../assets/volatility.png';
import buySide from '../assets/buy-side.png';
import sellSide from '../assets/sell-side.png';
import primaryCM from '../assets/primary-confusion-matrix.png';
import secondaryCM from '../assets/secondary-confusion-matrix.png';
import monkeyThrowDarts from '../assets/monkey-throw-darts.png';

<Heading style={{ marginBottom: 0 }}>
  Labelling Financial Data
  <br />
  <span style={{ fontSize: "8.5vmin" }}>
    è²¡å‹™ãƒ‡ãƒ¼ã‚¿ã®ãƒ©ãƒ™ãƒ«ä»˜ã‘
  </span>
</Heading> 
<Appear>
  <Heading size={2} style={{ color: "#737373" }}>
    with bonus Amazon Forecast.
  </Heading> 
</Appear>

---

# These slides are at Connpass. So you can check them out.
## ã‚¹ãƒ©ã‚¤ãƒ‰ã¯Connpassã«ã‚¢ãƒƒãƒ—ã•ã‚Œã¦ã„ã¾ã™ã€‚ æ˜¯éã¿ã¦ãã ã•ã„ã€‚

---

# Who am I?
## ãŠå‰èª°?

---

# My name is Alex, and I'm from Canada ğŸ‡¨ğŸ‡¦
## ã‚¢ãƒ¬ãƒƒã‚¯ã‚¹ã§ã€ã‚«ãƒŠãƒ€ã‹ã‚‰æ¥ã¾ã—ãŸã€‚

---

<Layout>
  <Fill style={{ margin: "auto" }}>
    <Heading size={3}>My username on Connpass is "globophobe".</Heading>
    <Heading size={4}>Connpassã®ãƒ¦ãƒ¼ã‚¶åã¯ã€Œglobophobeã€ã§ã™ã€‚</Heading>
  </Fill>
  <Fill>
    <Image style={{ borderRadius: "35px", marginLeft: "1em" }} src={arex} />
  </Fill>
</Layout>

---

# I make stuff with Python, Django, Vue.js and React Native. 
## Pythonã‚„Djangoã‚„Vue.jsã‚„React Nativeã§ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã—ã¦ã„ã¾ã™ã€‚

---

# This is just for fun.
## ã“ã‚Œã¯ãŸã ã®æ¥½ã—ã¿ã§ã™ã€‚

---

<Layout>
  <Fill style={{ margin: "auto" }}>
    <Heading>Recently, I have been reading this book.</Heading>
    <Heading size={2}>æœ€è¿‘ã“ã®æœ¬ã‚’èª­ã‚“ã§ã„ã¾ã™ã€‚</Heading>
  </Fill>
  <Fill>
    <Link href="https://www.amazon.co.jp/Advances-Financial-Machine-Learning-Marcos/dp/1119482089/">
      <Image style={{ height: "95vh", borderRadius: "10px", marginLeft: "1.5em" }} src={cover} />
    </Link>
  </Fill>
</Layout>

---

<Layout>
  <Fill style={{ margin: "auto" }}>
    <Heading>Currently, it is published in Japanese.</Heading>
    <Heading size={2}>ç¾åœ¨ã€æ—¥æœ¬èªã§å‡ºç‰ˆã•ã‚Œã¦ã„ã¾ã™ã€‚</Heading>
  </Fill>
  <Fill>
      <Link href="https://www.amazon.co.jp/%E3%83%95%E3%82%A1%E3%82%A4%E3%83%8A%E3%83%B3%E3%82%B9%E6%A9%9F%E6%A2%B0%E5%AD%A6%E7%BF%92-%E3%83%9E%E3%83%AB%E3%82%B3%E3%82%B9%E3%83%BB%E3%83%AD%E3%83%9A%E3%82%B9%E3%83%BB%E3%83%87%E3%83%BB%E3%83%97%E3%83%A9%E3%83%89/dp/4322134637/">
      <Image style={{ height: "95vh", borderRadius: "10px", marginLeft: "1.5em" }} src={coverJapanese} />
    </Link>
  </Fill>
</Layout>

---

<Layout>
  <Fill style={{ margin: "auto" }}>
    <Heading size={5}>
      The author Marcos Lopez de Prado was named <Link href="https://jpm.pm-research.com/quant-of-2019">Quant of 2019</Link> by the <Link href="https://jpm.pm-research.com/">Journal of Portfolio Management</Link>.
    </Heading>
    <Heading size={6}>JPMã«ã‚ˆã‚Šã€Œã‚¯ã‚©ãƒ³ãƒˆ ã‚ªãƒ– ã‚¶ ã‚¤ãƒ¤ãƒ¼ã€ã«é¸ã°ã‚Œã¾ã—ãŸã€‚</Heading>
  </Fill>
  <Fill>
    <Image style={{ height: "65vmin", borderRadius: "35px", marginLeft: "1em" }} src={marcos} />
  </Fill>
</Layout>

---

# According to Lopez de Prado, "One day in the near future, ML will dominate finance...
## ã€Œè¿‘ã„å°†æ¥ã€MLãŒé‡‘èã‚’æ”¯é…ã—ã¦...

---

# ...science will curtail guessing, and investing will not mean gambling."
## ç§‘å­¦ã¯æ¨æ¸¬ã‚’å‰Šæ¸›ã™ã‚‹ã¯ãšã§ã€è¿‘ãå°†æ¥ã«ã¯ã€æŠ•è³‡ã‚’ã™ã‚‹äº‹ã¯ã‚‚ã†ã‚®ãƒ£ãƒ³ãƒ–ãƒ«ã®æ„å‘³ã‚‚ã—ã¾ã›ã‚“ã€‚

---

# In Chapter 2, volume-based sampling was discussed.
## ç¬¬2ç« ã§ã¯ã€ãƒœãƒªãƒ¥ãƒ¼ãƒ ãƒ™ãƒ¼ã‚¹ã®ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã«ã¤ã„ã¦èª¬æ˜ã•ã‚Œã¦ã„ã¾ã—ãŸã€‚

---

# Volume-based sampling results in data that is closer to independent and identically distributed (IID) normal.
## ãƒœãƒªãƒ¥ãƒ¼ãƒ ãƒ™ãƒ¼ã‚¹ã®ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã«ã‚ˆã‚Šã€ç‹¬ç«‹ã—ãŸåŒä¸€åˆ†å¸ƒï¼ˆIIDï¼‰æ­£è¦ã«è¿‘ã„ãƒ‡ãƒ¼ã‚¿ãŒå¾—ã‚‰ã‚Œã¾ã™ã€‚

---

# However, raw transaction data is necessary for volume-based sampling.
## ã—ã‹ã—ã€ãƒœãƒªãƒ¥ãƒ¼ãƒ ãƒ™ãƒ¼ã‚¹ã®ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã«ã¯ç”Ÿã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ãŒå¿…è¦ã§ã™ã€‚

---

# Usually, such data is very expensive.
## é€šå¸¸ã€ãã®ã‚ˆã†ãªãƒ‡ãƒ¼ã‚¿ã¯éå¸¸ã«é«˜ä¾¡ã§ã™ã€‚

---

<Layout>
  <Fill style={{ margin: "auto" }}>
    <Heading size={2}>
      However, it is provided free by some Bitcoin exchanges.
    </Heading>
    <Heading size={3}>
      ã—ã‹ã—ã€ãƒ“ãƒƒãƒˆã‚³ã‚¤ãƒ³ã®å–å¼•æ‰€ã§ã¯ç„¡æ–™ã§æä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚
    </Heading>
  </Fill>
  <Fill>
    <Image style={{ borderRadius: "35px", marginTop: "50%", marginBottom: "-50%", marginLeft: "0.75em" }} src={bitcoin} />
  </Fill>
</Layout>

---

# My preference is data for the Bitmex XBTUSD perpetual future contract.
## ç§ã¯Bitmexã®XBTUSDã®æ°¸ç¶šçš„ãªå…ˆç‰©å¥‘ç´„ã®ãƒ‡ãƒ¼ã‚¿ã«ã—ã¾ã—ãŸã€‚

---

# In Chapter 3, labelling financial data is discussed.
## ç¬¬3ç« ã§ã¯è²¡å‹™ãƒ‡ãƒ¼ã‚¿ã®ãƒ©ãƒ™ãƒ«ä»˜ã‘ã«ã¤ã„ã¦èª¬æ˜ã•ã‚Œã¦ã„ã¾ã™ã€‚

---

# Most quantitative methods use fixed time horizon labeling methods.
## ã»ã¨ã‚“ã©ã®å®šé‡çš„æ–¹æ³•ã¯ã€å›ºå®šæ™‚é–“ç¯„å›²ãƒ©ãƒ™ãƒ«ä»˜ã‘æ–¹æ³•ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ 

---

# The label is determined when price touches the vertical barrier.
## ãƒ©ãƒ™ãƒ«ã¯ã€ä¾¡æ ¼ãŒå‚ç›´éšœå£ã«ã‚¿ãƒƒãƒã™ã‚‹ã¨æ±ºå®šã•ã‚Œã¾ã™ã€‚

---

<Image style={{ height: "80vh" }} src={fixedHorizon} />

---

# Lopez de Prado identifies two problems with such labels.
# ãã®ã‚ˆã†ãªãƒ©ãƒ™ãƒ«ã«é–¢ã™ã‚‹2ã¤ã®å•é¡Œã‚ã‚Šã¾ã™ã€‚
---

# 1) Time-horizon is fixed, but volatility is not.
## æœŸé–“ãŒå›ºå®šã•ã‚Œã¦ã„ã¾ã™ãŒã€ãƒœãƒ©ãƒ†ã‚£ãƒªãƒ†ã‚£ã¯å›ºå®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚

---

# 2) The realities of trading require both stop loss and take profit thresholds.
## å–å¼•ã®ç¾å®Ÿã«ã¯ã€ã‚¹ãƒˆãƒƒãƒ—ãƒ­ã‚¹ã¨åˆ©æ½¤ã®é–¾å€¤ã®ä¸¡æ–¹ãŒå¿…è¦ã§ã™ã€‚

---

# Lopez de Prado describes a "triple-barrier" labelling method.
## ã€Œãƒˆãƒªãƒ—ãƒ«ãƒãƒªã‚¢ã€ã¦è¨€ã†é‡‘èãƒ‡ãƒ¼ã‚¿ãƒ©ãƒ™ãƒ«ä»˜ã‘ã«ã¤ã„ã¦ãŒèª¬æ˜ã•ã‚Œã¦ã„ã¾ã™ã€‚

---

<Image style={{ height: "80vh" }} src={tripleBarrier} />

---

# The vertical barrier is the same as fixed-horizon labelling.
## å‚ç›´ãƒãƒªã‚¢ã¯ã€å›ºå®šæ°´å¹³ãƒ©ãƒ™ãƒ«ä»˜ã‘ã¨åŒã˜ã§ã™ã€‚

---

# The upper and lower barriers are initial take profit or stop loss thresholds.
## ä¸Šé™ã¨ä¸‹é™ã®éšœå£ã¯ã€æœ€å°ã®åˆ©æ½¤ã¾ãŸã¯ã‚¹ãƒˆãƒƒãƒ—ãƒ­ã‚¹ã®ã—ãã„å€¤ã§ã™ã€‚

---

## Lopez de Prado recommends calculating the upper and lower barriers with a point estimation of volatility... 
### ãƒœãƒ©ãƒ†ã‚£ãƒªãƒ†ã‚£ã®ãƒã‚¤ãƒ³ãƒˆæ¨å®šã‚’è¨ˆç®—ã—ã¦ã€ãã—ã¦ã®ãƒã‚¤ãƒ³ãƒˆæ¨å®šã§ä¸Šãƒãƒªã‚¢ã¨ä¸‹ãƒãƒªã‚¢ã®éšœå£ã‚’è¨ˆç®—ã™ã‚‹äº‹ãŒå‹§ã‚ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚

---

# ...which is the mean of the exponentially weighted moving standard deviation of returns.
## ...ãƒã‚¤ãƒ³ãƒˆæ¨å®šã¯ãƒªã‚¿ãƒ¼ãƒ³ã®æŒ‡æ•°åŠ é‡ç§»å‹•æ¨™æº–åå·®ã®å¹³å‡ã§ã™ã€‚

---

# Returns being defined as the percent change in price between time T and T - 1.
## æˆ»ã‚Šå€¤ã¯æ™‚é–“Tã¨T-1ã®é–“ã®ä¾¡æ ¼ã®å¤‰åŒ–ç‡ã¨ã—ã¦å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚

---

# As per the following function:
## æ¬¡ã®é–¢æ•°ã§è¨ˆç®—ã—ã¾ã™ï¼š

---

export default CodeSlide

```python
def get_volatility(prices, span=100, delta=pd.Timedelta(hours=24)):
    """Estimate volatality with exponentially weighted moving standard deviation of returns."""
    df = prices.index.searchsorted(prices.index - delta)
    df = df[df > 0]
    df = pd.Series(
        prices.index[df - 1], 
        index=prices.index[prices.shape[0] - df.shape[0]:]
    )
    diff = prices.loc[df.values].values - 1
    df = prices.loc[df.index] / diff
    df = df.ewm(span=span).std()
    return df
```

---

#### The exponentially weighted moving standard deviation of returns:
#### ãƒªã‚¿ãƒ¼ãƒ³ã®æŒ‡æ•°åŠ é‡ç§»å‹•æ¨™æº–åå·®ï¼š

<Image style={{ height: "50vmin" }} src={volatility} />

---

# The mean of which becomes the threshold for the following function:
## ãã®å¹³å‡ãŒæ¬¡ã®é–¢æ•°ã®ã—ãã„å€¤ã«ãªã‚Šã¾ã™ã€‚

---

export default CodeSlide

```python
def cusum_filter(prices, threshold):
    events, pos, neg = [], 0, 0
    diff = prices.diff()
    for idx in diff.index[1:]:
        pos = max(0, pos + diff.loc[idx])
        neg = min(0, neg + diff.loc[idx])
        if neg < -threshold:
            neg = 0; events.append(idx)
        elif pos > threshold:
            pos = 0; events.append(idx)
    return pd.DatetimeIndex(events)
```

---

# The *cusum_filter* reduces the price series to only data points greater or less than the threshold.
## *cusum_filter* ã¯ã€ä¾¡æ ¼ç³»åˆ—ã‚’ã—ãã„å€¤ã‚ˆã‚Šã‚‚å¤§ãã„ã¾ãŸã¯å°ã•ã„ãƒã‚¤ãƒ³ãƒˆã®ã¿ã«æ¸›ã‚‰ã—ã¾ã™ã€‚

---

## The *cusum_filter* is described as an "[improvement] over many popular financial indicators such as Bollinger bands... 
## * cusum_filter *ã¯äººæ°—ã®ã‚ã‚‹å¸‚å ´ä¿¡å·ã€Œãƒœãƒªãƒ³ã‚¸ãƒ£ãƒ¼ãƒãƒ³ãƒ‰ã€ã¨ã‹ã«å¯¾ã™ã‚‹[æ”¹å–„]ã¨ã—ã¦èª¬æ˜ã•ã‚Œã¦ã„ã¾ã™ã€‚

---

# ...as it resets at each sample, so as to not to fluctuate over a threshold.
## å„ã‚µãƒ³ãƒ—ãƒ«ã§ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ã€‚ã“ã®ã‚ˆã†ã«ã€ã—ãã„å€¤ã®è¿‘ãã‚’è¶…ãˆã¦å¤‰å‹•ã—ãªã„ã§ã™ã€‚

---

# The time of the first touch, to either upper, lower, or vertical barrier is calculated. 
## ä¸Šéƒ¨ã€ä¸‹éƒ¨ã€ã¾ãŸã¯å‚ç›´ãƒãƒªã‚¢ã¸ã®æœ€åˆã®ã‚¿ãƒƒãƒã®æ™‚é–“ãŒè¨ˆç®—ã•ã‚Œã¾ã™ã€‚

---

## These are some "triple-barrier" touches.
<Heading size={2} style={{ marginBottom: "0.5em" }}>ã€Œãƒˆãƒªãƒ—ãƒ«ãƒãƒªã‚¢ã€ã‚¿ãƒƒãƒã§ã™ã€‚</Heading>

<Table>
  <TableHeader>
    <TableHeaderItem style={{ fontSize: "5.5vmin" }}>timestamp</TableHeaderItem>
    <TableHeaderItem style={{ fontSize: "5.5vmin" }}>target</TableHeaderItem>
    <TableHeaderItem style={{ fontSize: "5.5vmin" }}>touch</TableHeaderItem>
  </TableHeader>
  <TableBody>
    <TableRow>
      <TableItem style={{ fontSize: "3.5vmin" }}>2017-03-22 13:58:33.411609</TableItem>
      <TableItem style={{ fontSize: "3.5vmin" }}>0.0662078</TableItem>
      <TableItem style={{ fontSize: "3.5vmin" }}>2017-03-23 14:14:25.540570</TableItem>
    </TableRow>
    <TableRow>
      <TableItem style={{ fontSize: "3.5vmin" }}>2017-07-21 02:25:36.397497</TableItem>
      <TableItem style={{ fontSize: "3.5vmin" }}>0.0168957</TableItem>
      <TableItem style={{ fontSize: "3.5vmin" }}>2017-07-21 03:04:44.531031</TableItem>
    </TableRow>
    <TableRow>
      <TableItem style={{ fontSize: "3.5vmin" }}>2018-12-17 12:12:43.155227</TableItem>
      <TableItem style={{ fontSize: "3.5vmin" }}>0.0141053</TableItem>
      <TableItem style={{ fontSize: "3.5vmin" }}>2018-12-17 12:12:57.062203</TableItem>
    </TableRow>
  </TableBody>
</Table>

---

## The touches are indexed with the original dataframe to become labels.
## ã‚¿ãƒƒãƒã¯å…ƒã®ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ã§ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä»˜ã‘ã•ã‚Œã€ãƒ©ãƒ™ãƒ«ã«ãªã‚Šã¾ã™ã€‚

<Table>
  <TableHeader>
    <TableHeaderItem style={{ fontSize: "5.5vmin" }}>timestamp</TableHeaderItem>
    <TableHeaderItem style={{ fontSize: "5.5vmin" }}>target</TableHeaderItem>
    <TableHeaderItem style={{ fontSize: "5.5vmin" }}>return</TableHeaderItem>
    <TableHeaderItem style={{ fontSize: "5.5vmin" }}>label</TableHeaderItem>
  </TableHeader>
  <TableBody>
    <TableRow>
      <TableItem style={{ fontSize: "4.5vmin" }}>2017-03-22 13:58:33.411609</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>0.066208</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>0.019608</TableItem>
      <TableItem style={{ fontSize: "5.5vmin" }}><strong>0</strong></TableItem>
    </TableRow>
    <TableRow>
      <TableItem style={{ fontSize: "4.5vmin" }}>2017-07-21 02:25:36.397497</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>0.016896</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>-0.018248</TableItem>
      <TableItem style={{ fontSize: "5.5vmin" }}><strong>-1</strong></TableItem>
    </TableRow>
    <TableRow>
      <TableItem style={{ fontSize: "4.5vmin" }}>2018-12-17 12:12:43.155227</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>0.014105</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>0.015244</TableItem>
      <TableItem style={{ fontSize: "5.5vmin" }}><strong>1</strong></TableItem>
    </TableRow>
  </TableBody>
</Table>

---

## *Label 0* return was less than target when the vertical barrier, the max-holding period, was touched.
## *ãƒ©ãƒ™ãƒ« 0 * æœ€å¤§ä¿æœ‰æœŸé–“ã§ã‚ã‚‹å‚ç›´éšœå£ã«è§¦ã‚ŒãŸã¨ãã®ãƒªã‚¿ãƒ¼ãƒ³ã¯ç›®æ¨™ã‚’ä¸‹å›ã£ã¦ã„ã¾ã—ãŸã€‚

<Table>
  <TableHeader>
    <TableHeaderItem style={{ fontSize: "5.5vmin" }}>timestamp</TableHeaderItem>
    <TableHeaderItem style={{ fontSize: "5.5vmin" }}>target</TableHeaderItem>
    <TableHeaderItem style={{ fontSize: "5.5vmin" }}>return</TableHeaderItem>
    <TableHeaderItem style={{ fontSize: "5.5vmin" }}>label</TableHeaderItem>
  </TableHeader>
  <TableBody>
    <TableRow>
      <TableItem style={{ fontSize: "4.75vmin" }}>2017-03-22 13:58:33.411609</TableItem>
      <TableItem style={{ fontSize: "5.5vmin" }}>0.066208</TableItem>
      <TableItem style={{ fontSize: "5.5vmin" }}>0.019608</TableItem>
      <TableItem style={{ fontSize: "5.5vmin" }}><strong>0</strong></TableItem>
    </TableRow>
  </TableBody>
</Table>

---

## *Label -1* return was negative when the lower barrier, stop-loss, was touched.
## *ãƒ©ãƒ™ãƒ« -1 * ä¸‹ã®éšœå£ã§ã‚ã‚‹ã‚¹ãƒˆãƒƒãƒ—ãƒ­ã‚¹ã«è§¦ã‚ŒãŸæ™‚ã®ãƒªã‚¿ãƒ¼ãƒ³ã¯è² ã§ã—ãŸã€‚

<Table>
  <TableHeader>
    <TableHeaderItem style={{ fontSize: "5.5vmin" }}>timestamp</TableHeaderItem>
    <TableHeaderItem style={{ fontSize: "5.5vmin" }}>target</TableHeaderItem>
    <TableHeaderItem style={{ fontSize: "5.5vmin" }}>return</TableHeaderItem>
    <TableHeaderItem style={{ fontSize: "5.5vmin" }}>label</TableHeaderItem>
  </TableHeader>
  <TableBody>
    <TableRow>
      <TableItem style={{ fontSize: "4.75vmin" }}>2017-07-21 02:25:36.397497</TableItem>
      <TableItem style={{ fontSize: "5.5vmin" }}>0.016896</TableItem>
      <TableItem style={{ fontSize: "5.5vmin" }}>-0.018248</TableItem>
      <TableItem style={{ fontSize: "5.5vmin" }}><strong>-1</strong></TableItem>
    </TableRow>
  </TableBody>
</Table>

---

## *Label 1* return was greater than target when the upper barrier, initial take-profit, was touched.
## *ãƒ©ãƒ™ãƒ« 1 * ä¸Šã®éšœå£ã§ã‚ã‚‹æœ€å°ã®åˆ©æ½¤ã«è§¦ã‚ŒãŸæ™‚ã®ãƒªã‚¿ãƒ¼ãƒ³ã¯ã¯ç›®æ¨™ã‚’ä¸Šå›ã‚Šã¾ã—ãŸã€‚

<Table>
  <TableHeader>
    <TableHeaderItem style={{ fontSize: "5.5vmin" }}>timestamp</TableHeaderItem>
    <TableHeaderItem style={{ fontSize: "5.5vmin" }}>target</TableHeaderItem>
    <TableHeaderItem style={{ fontSize: "5.5vmin" }}>return</TableHeaderItem>
    <TableHeaderItem style={{ fontSize: "5.5vmin" }}>label</TableHeaderItem>
  </TableHeader>
  <TableBody>
    <TableRow>
      <TableItem style={{ fontSize: "4.75vmin" }}>2018-12-17 12:12:43.155227</TableItem>
      <TableItem style={{ fontSize: "5.5vmin" }}>0.014105</TableItem>
      <TableItem style={{ fontSize: "5.5vmin" }}>0.015244</TableItem>
      <TableItem style={{ fontSize: "5.5vmin" }}><strong>1</strong></TableItem>
    </TableRow>
  </TableBody>
</Table>

---

# *Label 1* and *Label -1* indicate a trading opportunity.
## *ãƒ©ãƒ™ãƒ« 1* ã¾ãŸã¯ *ãƒ©ãƒ™ãƒ« -1* ã¯ã€å–å¼•ã®æ©Ÿä¼šãŒã‚ã‚‹ã®æ„å‘³ã—ã¾ã™ã€‚

---

# Buy low and sell high.
## å®‰å€¤ã§è³¼å…¥ã€é«˜å€¤ã§è²©å£²ã€‚

<Image style={{ height: "60vh" }} src={buySide} />

---

# Sell high and buy low.
## é«˜å€¤ã§å£²ã‚Šã€ä½å€¤ã§è²·ã„ã¾ã™ã€‚

<Image style={{ height: "60vh" }} src={sellSide} />

---

# Selling high and buying low implies selling short on margin.
## è¨¼æ‹ é‡‘ã§ç©ºå£²ã‚Šã®å–å¼•ã‚’æ„å‘³ã—ã¾ã™ã€‚æŒã£ã¦ã„ãªã„ã‚‚ã®ã‚’å£²ã‚‹ã€‚

---

# For example, using Â¥100,000 as margin (collateral) to sell Â¥1,000,000.
## ãŸã¨ãˆã°ã€100,000å††ã‚’ãƒãƒ¼ã‚¸ãƒ³ï¼ˆæ‹…ä¿ï¼‰ã¨ã—ã¦ä½¿ç”¨ã—ã¦ã€1,000,000å††ã‚’è²©å£²ã—ã¾ã™ã€‚

---

# *Label 0*, suggests not enough volatility for trading to be worthwhile.
## *ãƒ©ãƒ™ãƒ« 0*ã€ å–å¼•ã«å€¤ã™ã‚‹ãƒœãƒ©ãƒ†ã‚£ãƒªãƒ†ã‚£ãŒååˆ†ã§ãªã„äº‹ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚

---

# Lopez de Prado also discusses "meta-labelling".
## ã€Œãƒ¡ã‚¿ãƒ©ãƒ™ãƒ«ã€ã¦è¨€ã†äº‹ã¯ã‚‚èª¬æ˜ã•ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚

---

# Output from a primary model become input for a secondary model.
## ãƒ—ãƒ©ã‚¤ãƒãƒªãƒ¢ãƒ‡ãƒ«ã®è³ªåŠ›äºˆæ¸¬ã¯ã€ã‚»ã‚«ãƒ³ãƒ€ãƒªãƒ¢ãƒ‡ãƒ«ã®å…¥åŠ›ã«ãªã‚Šã¾ã™ã€‚

---

# Lopez de Prado says meta-labelling can be particulary useful...
## ã€Œãƒ¡ã‚¿ãƒ©ãƒ™ãƒ«ã€ãŒç‰¹ã«æœ‰ç”¨ã®ã¯...

---

# ...when outcomes are asymmetric, as it can help avoid large drawdowns.
## ...çµæœã¯éå¯¾ç§°æ™‚ã§ã™ã€‚å¤§ãã„ãªæå¤±ã‚’å›é¿ã™ã‚‹äº‹ã‚’åŠ©ã‘ã‚‹ã‚“ã‹ã‚‰ã§ã™ã€‚

---

# The primary model should have high recall, many true positives, and as few false positives as possible. 
## ãƒ—ãƒ©ã‚¤ãƒãƒªãƒ¢ãƒ‡ãƒ«ã¯ã€é«˜ã„å†ç¾ç‡ã—ã¹ãã§ã€å¤šãã®çœŸã®é™½æ€§ã‚ˆã†ã§ã€å‡ºæ¥ã‚‹ã ã‘èª¤æ¤œçŸ¥ãŒã™ããªã„ã‚ˆã†ã§ã™ã€‚

---

# The secondary model filters the false positives from the primary model.
## ã‚»ã‚«ãƒ³ãƒ€ãƒªãƒ¢ãƒ‡ãƒ«ã¯ã€ãƒ—ãƒ©ã‚¤ãƒãƒªãƒ¢ãƒ‡ãƒ«ã‹ã‚‰ã®èª¤æ¤œå‡ºã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã—ã¾ã™ã€‚

---

# The following is a simplified example:
## æ¬¡ã¯å˜ç´”åŒ–ã—ãŸã®ä¾‹ã§ã™ï¼š

---

### Data is close price and volume, XBTUSD $10000000 volume bars:
#### ãƒ‡ãƒ¼ã‚¿ã¯XBTUSDã®çµ‚å€¤ã¨ãƒœãƒªãƒ¥ãƒ¼ãƒ ã€$10000000ã®ãƒœãƒªãƒ¥ãƒ¼ãƒ ãƒãƒ¼ï¼š

<Table>
  <TableHeader>
    <TableHeaderItem style={{ fontSize: "5.5vmin" }}>timestamp</TableHeaderItem>
    <TableHeaderItem style={{ fontSize: "5.5vmin" }}>close</TableHeaderItem>
    <TableHeaderItem style={{ fontSize: "5.5vmin" }}>volume</TableHeaderItem>
  </TableHeader>
  <TableBody>
    <TableRow>
      <TableItem style={{ fontSize: "5vmin" }}>2020-01-14 18:13:02.951683</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>8858.5</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>10001522</TableItem>
    </TableRow>
    <TableRow>
      <TableItem style={{ fontSize: "5vmin" }}>2020-01-15 01:07:18.109534</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>8730.0</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>10000005</TableItem>
    </TableRow>
    <TableRow>
      <TableItem style={{ fontSize: "5vmin" }}>2020-01-15 04:06:15.848101</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>8651.0</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>10000340</TableItem>
    </TableRow>
    <TableRow>
      <TableItem style={{ fontSize: "5vmin" }}>2020-01-15 13:57:39.592160</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>8878.0</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>10000444</TableItem>
    </TableRow>
    <TableRow>
      <TableItem style={{ fontSize: "4.5vmin" }}>2020-01-15 16:03:29.038104</TableItem>
      <TableItem style={{ fontSize: "4.5vmin" }}>8725.5</TableItem>
      <TableItem style={{ fontSize: "4.5vmin" }}>10145705</TableItem>
    </TableRow>
  </TableBody>
</Table>

---

export default CodeSlide


```python
from sklearn.linear_model import LogisticRegression
```

```python
# Split train and test data.
split = int(len(df) * .7)
x = df[["close", "volume"]].values
y = df[["label"]].values
x_train, y_train = x[:split], y[:split]
x_test, y_test = x[split:], y[:split]
```

```python
# Resample using SMOTE, and fit.
x_train_res, y_train_res = SMOTE().fit_sample(x_train, y_train)
primary_model = LogisticRegression().fit(x_train_res, y_train_res)
y_pred = primary_model.predict(x_test)
```

---

export default CodeSlide

```python
def true_meta_labels(y_pred, y_test):
    """Labels were 0, 1, and -1. Correctly predicted labels of 1 or -1 will be 1."""
    bin_label = np.zeros_like(y_pred)
    for i in range(y_pred.shape[0]):
        if y_pred[i] != 0 and (y_pred[i] * y_test[i]) > 0:
            bin_label[i] = 1  # True Positive
    return bin_label
```

```python
true_binary = true_binary_label(y_pred, y_test)
cm = confusion_matrix(true_binary, y_pred != 0)
```

---

### Primary model: 

<Text><S type="bold">859 false positives (FP)</S></Text>
<Text><S type="bold">0 false negatives (FN)</S></Text>

<Image style={{ height: "65vh", marginTop: "0.5em" }} src={primaryCM} />

---

# Add predictions from primary model to training data of the secondary model.
## ãƒ—ãƒ©ã‚¤ãƒãƒªãƒ¢ãƒ‡ãƒ«ã®äºˆæ¸¬ã‚’ã‚»ã‚«ãƒ³ãƒ€ãƒªãƒ¢ãƒ‡ãƒ«ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã«è¿½åŠ ã—ã¾ã™ã€‚

---

export default CodeSlide

```python
# Predictions added as feature to secondary model.
y_train_pred = primary_model.predict(x_train) 
x_train_meta = np.hstack([y_train_pred[:, None], x_train])
x_test_meta = np.hstack([y_pred[:, None], x_test])
y_train_meta = true_meta_labels(y_train_pred, y_train)
```

```python
# Resample using SMOTE, and fit.
x_train_meta_res, y_train_meta_res = SMOTE().fit_sample(
    x_train_meta, y_train_meta
)
secondary_model = LogisticRegression().fit(
    x_train_meta_res, y_train_meta_res
)
y_pred_meta = secondary_model.predict(x_test_meta)
```

---

# Secondary model: 

<Text><S type="bold">472 false positives (FP)</S></Text>
<Text><S type="bold">132 false negatives (FN)</S></Text>

<Image style={{ height: "65vh", marginTop: "0.5em" }} src={secondaryCM} />

---

# Meta-labelling reduces number of false positives assymetrically to an increase in number of false negatives.
## ãƒ¡ã‚¿ãƒ©ãƒ™ãƒ«ã¯ã€ å½é™½æ€§ã®æ•°ãŒå½é™°æ€§ã®æ•°ã®å¢—ãˆéå¯¾ç§°çš„ã«æ¸›ã‚Šã¾ã™ã€‚	

---

# Classification report, primary model:

<Table>
  <TableHeader>
    <TableHeaderItem />
    <TableHeaderItem style={{ fontSize: "5vmin" }}>precision</TableHeaderItem>
    <TableHeaderItem style={{ fontSize: "5vmin" }}>recall</TableHeaderItem>
    <TableHeaderItem style={{ fontSize: "5vmin" }}>f1-score</TableHeaderItem>
    <TableHeaderItem style={{ fontSize: "5vmin" }}>support</TableHeaderItem>
  </TableHeader>
  <TableBody>
    <TableRow>
      <TableItem>&nbsp;</TableItem>
    </TableRow>
    <TableRow>
      <TableItem style={{ fontSize: "5vmin" }}>0.0</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>1.00</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>0.52</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}><strong>0.69</strong></TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>1756</TableItem>
    </TableRow>
    <TableRow>
      <TableItem style={{ fontSize: "5vmin" }}>1.0</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>0.32</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>1.00</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}><strong>0.48</strong></TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>392</TableItem>
    </TableRow>
    <TableRow>
      <TableItem style={{ fontSize: "5vmin" }}>&nbsp;</TableItem>
    </TableRow>
    <TableRow>
      <TableItem style={{ fontSize: "5vmin" }}>accuracy</TableItem>
      <TableItem />
      <TableItem />
      <TableItem style={{ fontSize: "5vmin" }}>0.61</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>2148</TableItem>
    </TableRow>
    <TableRow>
      <TableItem style={{ fontSize: "5vmin" }}>macro avg</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>0.66</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>0.76</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>0.59</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>2148</TableItem>
    </TableRow>
    <TableRow>
      <TableItem style={{ fontSize: "5vmin" }}>weighted avg</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>0.88</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>0.61</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>0.65</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>2148</TableItem>
    </TableRow>
  </TableBody>
</Table>

---

# Secondary model, f1-score is improved:

<Table>
  <TableHeader>
    <TableHeaderItem />
    <TableHeaderItem style={{ fontSize: "5vmin" }}>precision</TableHeaderItem>
    <TableHeaderItem style={{ fontSize: "5vmin" }}>recall</TableHeaderItem>
    <TableHeaderItem style={{ fontSize: "5vmin" }}>f1-score</TableHeaderItem>
    <TableHeaderItem style={{ fontSize: "5vmin" }}>support</TableHeaderItem>
  </TableHeader>
  <TableBody>
    <TableRow>
      <TableItem style={{ fontSize: "5vmin" }}>&nbsp;</TableItem>
    </TableRow>
    <TableRow>
      <TableItem style={{ fontSize: "5vmin" }}>0.0</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>0.91</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>0.73</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}><strong>0.81</strong></TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>1756</TableItem>
    </TableRow>
    <TableRow>
      <TableItem style={{ fontSize: "5vmin" }}>1.0</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>0.36</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>0.67</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}><strong>0.47</strong></TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>392</TableItem>
    </TableRow>
    <TableRow>
      <TableItem style={{ fontSize: "5vmin" }}>&nbsp;</TableItem>
    </TableRow>
    <TableRow>
      <TableItem style={{ fontSize: "5vmin" }}>accuracy</TableItem>
      <TableItem />
      <TableItem />
      <TableItem style={{ fontSize: "5vmin" }}>0.72</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>2148</TableItem>
    </TableRow>
    <TableRow>
      <TableItem style={{ fontSize: "5vmin" }}>macro avg</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>0.63</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>0.70</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>0.64</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>2148</TableItem>
    </TableRow>
    <TableRow>
      <TableItem style={{ fontSize: "5vmin" }}>weighted avg</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>0.81</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>0.72</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>0.75</TableItem>
      <TableItem style={{ fontSize: "5vmin" }}>2148</TableItem>
    </TableRow>
  </TableBody>
</Table>

---

# Intuitively, it may be preferable to do nothing (FN), than be exposed to a loss (FP).
## ç›´æ„Ÿçš„ã«ã€æå¤±ï¼ˆFPï¼‰ã«ã•ã‚‰ã•ã‚Œã‚‹ã‚ˆã‚Šã‚‚ã€ä½•ã‚‚ã—ãªã„ï¼ˆFNï¼‰æ–¹ãŒæœ›ã¾ã—ã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

---

### Lopez de Prado emphasizes that the primary model need not be an ML model. It could be the decisions of a discretionary trader.
#### ãƒ—ãƒ©ã‚¤ãƒãƒªãƒ¢ãƒ‡ãƒ«ã¯MLãƒ¢ãƒ‡ãƒ«ã§ã‚ãªãã¦ã‚‚è‰¯ã„äº‹ã‚’å¼·èª¿ã•ã‚Œã¦ã„ã¾ã™ã€‚ãƒ—ãƒ©ã‚¤ãƒãƒªãƒ¢ãƒ‡ãƒ«ã¯è£é‡çš„ãƒˆãƒ¬ãƒ¼ãƒ€ãƒ¼ã®å–å¼•åˆ¤æ–­ã®å¯èƒ½æ€§ã‚‚ã‚ã‚Šã¾ã™ã€‚


---

<Layout>
  <Fill style={{ margin: "auto" }}>
    <Heading size={5}>He doesn't say it, but the primary model could even be a monkey throwing darts. </Heading>
    <Heading size={5}>å½¼ã¯è¨€ã‚ãªã„äº‹ã§ã™ã‘ã‚Œã©ã€ãƒ—ãƒ©ã‚¤ãƒãƒªãƒ¢ãƒ‡ãƒ«ã¯ãƒ€ãƒ¼ãƒ„ã‚’æŠ•ã’ã‚‹çŒ¿ã®å¯èƒ½æ€§ã‚‚ã‚ã‚Šã¾ã™ã€‚</Heading>
  </Fill>
  <Fill>
    <Image style={{ borderRadius: "35px" }} src={monkeyThrowDarts} />
  </Fill>
</Layout>

---

# In a recent <Link href="https://time.com/5751190/investing-machine-learning-marcos-de-lopez-prado/">article in Time magazine</Link>, Lopez de Prado states...
## ã‚¿ã‚¤ãƒ èªŒã®æœ€è¿‘ã®è¨˜äº‹ã§ã€ãƒ­ãƒšã‚¹ãƒ»ãƒ‡ãƒ»ãƒ—ãƒ©ãƒ‰ã¯...æ¬¡ã®äº‹ã‚’ä¼ãˆã¾ã—ãŸ...

---

# ...[for financial data] ML should be used as a research tool, and not as a forecasting tool.
## [è²¡å‹™ãƒ‡ãƒ¼ã‚¿ã®å ´åˆ] MLã¯ã€äºˆæ¸¬ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦ã§ã¯ãªãã€èª¿æŸ»ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹ã¹ãã§ã™ã€‚

---

# This precludes using Amazon Forecast.
## ãƒ“ãƒƒãƒˆã‚³ã‚¤ãƒ³ã®å°†æ¥ã®å€¤æ®µã‚’äºˆæ¸¬ã—ã¦ã¿ã‚‹ãŸã‚ã«Amazon Forecastã‚’ä½¿ç”¨ã—ãªã„æ–¹ãŒè‰¯ã„ã§ã™ã€‚

---

# However, let's try anyway.
## ã—ã‹ã—ã€ã¨ã«ã‹ãè©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

---

# Thatâ€™s all. Thanks for listening.
## ä»¥ä¸Šã§ã™ã€‚ã”æ¸…è´ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚
