import { Layout, Image, Fit, Fill, Heading, Table, TableHeader, TableHeaderItem, TableBody, TableRow, TableItem } from 'spectacle';
import { DarkSlide, CodeSlide } from './slides';
import RegularComponent from './regular-component';
import arex from '../assets/arex.jpg';
import cover from '../assets/cover.jpg';
import coverJapanese from '../assets/cover-japanese.jpg';
import marcos from '../assets/marcos.jpg';
import bitcoin from '../assets/bitcoin.png';
import fixedHorizon from '../assets/fixed-horizon.png';
import tripleBarrier from '../assets/triple-barrier.png';
import volatility from '../assets/volatility.png';
import buySide from '../assets/buy-side.png';
import sellSide from '../assets/sell-side.png';

<Heading>
  Labelling Financial Data
  <br />
  <span style={{ color: "#737373" }}>with bonus Amazon Forecast.</span>
</Heading> 
<Heading size={2} style={{ marginBottom: "0.1em" }} >
  è²¡å‹™ãƒ‡ãƒ¼ã‚¿ã®ãƒ©ãƒ™ãƒ«ä»˜ã‘
</Heading>
<Heading size={2}>
  <span style={{ color: "#737373", }}>ãŠã¾ã‘ã€Amazon Forecastã€‚</span>
</Heading>

---

# These slides are at Connpass. So you can check them out.
## ã‚¹ãƒ©ã‚¤ãƒ‰ã¯Connpassã«ã‚¢ãƒƒãƒ—ã•ã‚Œã¦ã„ã¾ã™ã€‚ æ˜¯éã¿ã¦ãã ã•ã„ã€‚

---

# Who am I?
## ãŠå‰èª°?

---

# My name is Alex, and I'm from Canada ğŸ‡¨ğŸ‡¦.
## ã‚¢ãƒ¬ãƒƒã‚¯ã‚¹ã§ã€ã‚«ãƒŠãƒ€ã‹ã‚‰æ¥ã¾ã—ãŸã€‚

---

<Layout>
  <Fill style={{ margin: "auto" }}>
    <Heading>My username on Connpass is "globophobe".</Heading>
    <Heading size={2}>Connpassã®ãƒ¦ãƒ¼ã‚¶åã¯ã€Œglobophobeã€ã§ã™ã€‚</Heading>
  </Fill>
  <Fill>
    <Image style={{ borderRadius: "35px", marginLeft: "35px" }} src={arex} />
  </Fill>
</Layout>

---

# I make stuff with Python, Django, Vue.js and React Native. 
## Pythonã‚„Djangoã‚„Vue.jsã‚„React Nativeã§ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã—ã¦ã„ã¾ã™ã€‚

---

# This is just for fun.
## ã“ã‚Œã¯ãŸã ã®æ¥½ã—ã¿ã§ã™ã€‚

---

<Layout>
  <Fill style={{ margin: "auto" }}>
    <Heading>Recently, I have been reading this book.</Heading>
    <Heading size={2}>
      æœ€è¿‘ã€ã€ŒAdvances in Financial Machine Learningã€ã¦è¨€ã†æœ¬ã‚’èª­ã‚“ã§ã„ã¾ã™ã€‚
    </Heading>
  </Fill>
  <Fill>
      <a href="https://www.amazon.co.jp/Advances-Financial-Machine-Learning-Marcos/dp/1119482089/">
      <Image style={{ height: "96vh", borderRadius: "10px", marginLeft: "auto", marginRight: "auto" }} src={cover} />
    </a>
  </Fill>
</Layout>

---

<Layout>
  <Fill style={{ margin: "auto" }}>
    <Heading>It is currently published in Japanese.</Heading>
    <Heading size={2}>ç¾åœ¨æ—¥æœ¬èªã§å‡ºç‰ˆã•ã‚Œã¦ã„ã¾ã™ã€‚</Heading>
  </Fill>
  <Fill>
      <a href="https://www.amazon.co.jp/%E3%83%95%E3%82%A1%E3%82%A4%E3%83%8A%E3%83%B3%E3%82%B9%E6%A9%9F%E6%A2%B0%E5%AD%A6%E7%BF%92-%E3%83%9E%E3%83%AB%E3%82%B3%E3%82%B9%E3%83%BB%E3%83%AD%E3%83%9A%E3%82%B9%E3%83%BB%E3%83%87%E3%83%BB%E3%83%97%E3%83%A9%E3%83%89/dp/4322134637/">
      <Image style={{ height: "96vh", borderRadius: "10px", marginLeft: "auto", marginRight: "auto" }} src={coverJapanese} />
    </a>
  </Fill>
</Layout>

---

<Layout>
  <Fill style={{ margin: "auto" }}>
    <Heading size={2}>
      The author Marcos Lopez de Prado was named <a href="https://jpm.pm-research.com/quant-of-2019">Quant of 2019</a> by the <a href="https://jpm.pm-research.com/">Journal of Portfolio Management</a>
    </Heading>
    <Heading size={2}>è‘—è€…ã¯ã€JPMã«ã‚ˆã‚Šã€Œã‚¯ã‚©ãƒ³ãƒˆ ã‚ªãƒ– ã‚¶ ã‚¤ãƒ¤ãƒ¼ã€ã«é¸ã°ã‚Œã¾ã—ãŸã€‚</Heading>
  </Fill>
  <Fill>
    <Image style={{ height: "80vh", borderRadius: "35px", marginLeft: "35px" }} src={marcos} />
  </Fill>
</Layout>

---

# According to the author, "One day in the near future, ML will dominate finance...
## è‘—è€…ã«ã‚ˆã‚‹ã¨ã€ã€Œè¿‘ã„å°†æ¥ã€MLãŒé‡‘èã‚’æ”¯é…ã—ã¦ã€ã€ã€

---

# ...science will curtail guessing, and investing will not mean gambling."
## ç§‘å­¦ã¯æ¨æ¸¬ã‚’å‰Šæ¸›ã—ã€ãã—ã¦ãã®è¿‘ãå°†æ¥ã«ã¯ã€æŠ•è³‡ã‚’ã™ã‚‹äº‹ã¯ã‚‚ã†ã‚®ãƒ£ãƒ³ãƒ–ãƒ«ã®æ„å‘³ã‚‚ã—ã¾ã›ã‚“ã€‚ã€

---

# In Chapter 2, volume clock sampling was discussed.
## ç¬¬2ç« ã§ã¯è²¡å‹™ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã«ã¤ã„ã¦

---

# In a <a href="https://twitter.com/JacquesQuant/status/1210309445202436100">question</a> on twitter, a lead developer of the <a href="https://github.com/hudson-and-thames/mlfinlab">MLFinLab</a> package...

---

# ...which implements Lopez de Prado's research... 

---

# ...asks about the importance of volume clock sampling.

---

# Lopez de Prado answered, "I would use volume clock whenever possible...

---

# ...even if the analysis also appears to work with chronological time."

---

# Volume clock sampling might create a new bar every $10,000,000.
## ãƒ‰ãƒ«ãƒãƒ¼ã¯10,000,000ãƒ‰ãƒ«ã”ã¨ã«æ–°ã—ã„ãƒãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚

---

# When the markets are moving quickly, there will be more data points...
## å¸‚å ´ãŒæ€¥é€Ÿã«å‹•ã„ã¦ã„ã‚‹ã¨ãã€ã‚ˆã‚Šå¤šãã®ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆãŒã‚ã£ã¦ã€

---

# And, when markets are moving slowly, there will be fewer data points.
## ãã—ã¦ã€å¸‚å ´ãŒã‚†ã£ãã‚Šã¨å‹•ã„ã¦ã„ã‚‹å ´åˆã€ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆãŒå°‘ãªããªã‚Šã¾ã™ã€‚

---

# Unfortunately, raw transaction data is necessary for volume clock sampling.
## ç”Ÿã®å–å¼•ãƒ‡ãƒ¼ã‚¿ã¯ã€ãƒ†ã‚£ãƒƒã‚¯ã€ãƒœãƒªãƒ¥ãƒ¼ãƒ ã€ã¾ãŸã¯ãƒ‰ãƒ«ãƒ™ãƒ¼ã‚¹ã®ãƒãƒ¼ã‚’ä½œæˆã™ã‚‹ãŸã‚ã«å¿…è¦ã§ã™ã€‚

---

# Usually, such data is very expensive.
## é€šå¸¸ã€ãã®ã‚ˆã†ãªãƒ‡ãƒ¼ã‚¿ã¯éå¸¸ã«é«˜ä¾¡ã§ã™ã€‚

---

<Layout>
  <Fill style={{ margin: "auto" }}>
    <Heading>
      However, it is often provided free by Bitcoin exchanges.
    </Heading>
    <Heading size={2}>
      Bitmexã¯ã€Amazon S3ãƒã‚±ãƒƒãƒˆã‹ã‚‰å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã¸ã®ç„¡æ–™ã‚¢ã‚¯ã‚»ã‚¹ã‚’æä¾›ã—ã¾ã™ã€‚
    </Heading>
  </Fill>
  <Fill>
    <Image style={{ borderRadius: "35px", marginTop: "50%", marginBottom: "50%", marginLeft: "35px" }} src={bitcoin} />
  </Fill>
</Layout>

---

# My preference is data from the Bitmex XBTUSD perpetual future contract.

---

# In Chapter 3, labelling financial data is discussed.
## ç¬¬3ç« ã§ã¯è²¡å‹™ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã«ã¤ã„ã¦

---

# Most quantitative methods use fixed-horizon labeling methods.
## 

---

<Image style={{ height: "80vh" }} src={fixedHorizon} />

---

# Lopez de Prado identifies two problems with such labels.

---

# First, time-horizon is fixed, but volatility is not.

---

# Second, the realities of trading require take-profit or stop-loss thresholds.

---

# Such thresholds imply closing the trading position, either taking profits or accepting the loss.

---

# Lopez de Prado suggests a "triple-barrier" labelling method.

---

<Image style={{ height: "80vh" }} src={tripleBarrier} />

---

# The horizontal barrier is the same as fixed-horizon labelling.

---

# Lopez de Prado suggests calculating the upper and lower barriers using a point estimation of volatility... 

---

# ...which is the mean of the standard deviation of an exponential moving average of returns.
## ...ç¾åœ¨ã®ä¾¡æ ¼ã®æŒ‡æ•°ç§»å‹•å¹³å‡ã‚’å‰ã®ä¾¡æ ¼ã§å‰²ã£ãŸæ¨™æº–åå·®ã®å¹³å‡ã§ã™ã€‚

---

# Returns being defined as the current price divided by the previous price.

---

# As per the following code...

---

export default CodeSlide

```python
def get_volatility(prices, span=100, delta=pd.Timedelta(hours=24)):
  df = prices.index.searchsorted(prices.index - delta)
  df = df[df > 0]
  df = pd.Series(prices.index[df0-1],    
           index=prices.index[prices.shape[0]-df.shape[0] : ])
  df = prices.loc[df.index] / prices.loc[df.values].values - 1
  df = df.ewm(span=span).std()
  return df
}
```

---

## The standard deviation of the exponential moving average of returns:

<Image style={{ height: "65vh" }} src={volatility} />

---

## This is a sample of 3 events calculated using volatility:

<Table>
  <TableHeader>
    <TableHeaderItem style={{ fontSize: "2vw" }}>event</TableHeaderItem>
    <TableHeaderItem style={{ fontSize: "2vw" }}>timestamp</TableHeaderItem>
    <TableHeaderItem style={{ fontSize: "2vw" }}>target</TableHeaderItem>
    <TableHeaderItem style={{ fontSize: "2vw" }}>touch</TableHeaderItem>
  </TableHeader>
  <TableBody>
    <TableRow>
      <TableItem style={{ fontSize: "2vw" }}>1</TableItem>
      <TableItem style={{ fontSize: "2vw" }}>2017-03-22 13:58:33.411609</TableItem>
      <TableItem style={{ fontSize: "2vw" }}>0.0662078</TableItem>
      <TableItem style={{ fontSize: "2vw" }}>2017-03-23 14:14:25.540570</TableItem>
    </TableRow>
    <TableRow>
      <TableItem style={{ fontSize: "2vw" }}>2</TableItem>
      <TableItem style={{ fontSize: "2vw" }}>2017-07-21 02:25:36.397497</TableItem>
      <TableItem style={{ fontSize: "2vw" }}>0.0168957</TableItem>
      <TableItem style={{ fontSize: "2vw" }}>2017-07-21 03:04:44.531031</TableItem>
    </TableRow>
    <TableRow>
      <TableItem style={{ fontSize: "2vw" }}>3</TableItem>
      <TableItem style={{ fontSize: "2vw" }}>2018-12-17 12:12:43.155227</TableItem>
      <TableItem style={{ fontSize: "2vw" }}>0.0141053</TableItem>
      <TableItem style={{ fontSize: "2vw" }}>2018-12-17 12:12:57.062203</TableItem>
    </TableRow>
  </TableBody>
</Table>

---

## The events are indexed with the original dataframe to become labels.

<Table>
  <TableHeader>
    <TableHeaderItem style={{ fontSize: "2vw" }}>event</TableHeaderItem>
    <TableHeaderItem style={{ fontSize: "2vw" }}>timestamp</TableHeaderItem>
    <TableHeaderItem style={{ fontSize: "2vw" }}>target</TableHeaderItem>
    <TableHeaderItem style={{ fontSize: "2vw" }}>return</TableHeaderItem>
    <TableHeaderItem style={{ fontSize: "2vw" }}>label</TableHeaderItem>
  </TableHeader>
  <TableBody>
    <TableRow>
      <TableItem style={{ fontSize: "2vw" }}>1</TableItem>
      <TableItem style={{ fontSize: "2vw" }}>2017-03-22 13:58:33.411609</TableItem>
      <TableItem style={{ fontSize: "2vw" }}>0.066208</TableItem>
      <TableItem style={{ fontSize: "2vw" }}>0.019608</TableItem>
      <TableItem style={{ fontSize: "2vw" }}>0</TableItem>
    </TableRow>
    <TableRow>
      <TableItem style={{ fontSize: "2vw" }}>2</TableItem>
      <TableItem style={{ fontSize: "2vw" }}>2017-07-21 02:25:36.397497</TableItem>
      <TableItem style={{ fontSize: "2vw" }}>0.016896</TableItem>
      <TableItem style={{ fontSize: "2vw" }}>-0.018248</TableItem>
      <TableItem style={{ fontSize: "2vw" }}>-1</TableItem>
    </TableRow>
    <TableRow>
      <TableItem style={{ fontSize: "2vw" }}>3</TableItem>
      <TableItem style={{ fontSize: "2vw" }}>2018-12-17 12:12:43.155227</TableItem>
      <TableItem style={{ fontSize: "2vw" }}>0.014105</TableItem>
      <TableItem style={{ fontSize: "2vw" }}>0.015244</TableItem>
      <TableItem style={{ fontSize: "2vw" }}>1</TableItem>
    </TableRow>
  </TableBody>
</Table>

---

## Event "1", return was less than target when horizontal barrier, max time, was hit.

<Table>
  <TableHeader>
    <TableHeaderItem style={{ fontSize: "2vw" }}>event</TableHeaderItem>
    <TableHeaderItem style={{ fontSize: "2vw" }}>timestamp</TableHeaderItem>
    <TableHeaderItem style={{ fontSize: "2vw" }}>target</TableHeaderItem>
    <TableHeaderItem style={{ fontSize: "2vw" }}>return</TableHeaderItem>
    <TableHeaderItem style={{ fontSize: "2vw" }}>label</TableHeaderItem>
  </TableHeader>
  <TableBody>
    <TableRow>
      <TableItem style={{ fontSize: "2vw" }}>1</TableItem>
      <TableItem style={{ fontSize: "2vw" }}>2017-03-22 13:58:33.411609</TableItem>
      <TableItem style={{ fontSize: "2vw" }}>0.066208</TableItem>
      <TableItem style={{ fontSize: "2vw" }}>0.019608</TableItem>
      <TableItem style={{ fontSize: "2vw" }}>0</TableItem>
    </TableRow>
  </TableBody>
</Table>

---

## Event "2", return was negative when lower barrier, stop-loss, was hit.

<Table>
  <TableHeader>
    <TableHeaderItem style={{ fontSize: "2vw" }}>event</TableHeaderItem>
    <TableHeaderItem style={{ fontSize: "2vw" }}>timestamp</TableHeaderItem>
    <TableHeaderItem style={{ fontSize: "2vw" }}>target</TableHeaderItem>
    <TableHeaderItem style={{ fontSize: "2vw" }}>return</TableHeaderItem>
    <TableHeaderItem style={{ fontSize: "2vw" }}>label</TableHeaderItem>
  </TableHeader>
  <TableBody>
    <TableRow>
      <TableItem style={{ fontSize: "2vw" }}>2</TableItem>
      <TableItem style={{ fontSize: "2vw" }}>2017-07-21 02:25:36.397497</TableItem>
      <TableItem style={{ fontSize: "2vw" }}>0.016896</TableItem>
      <TableItem style={{ fontSize: "2vw" }}>-0.018248</TableItem>
      <TableItem style={{ fontSize: "2vw" }}>-1</TableItem>
    </TableRow>
  </TableBody>
</Table>

---

## Event "3", return was greater than target when upper barrier, take-profit, was hit.

<Table>
  <TableHeader>
    <TableHeaderItem style={{ fontSize: "2vw" }}>event</TableHeaderItem>
    <TableHeaderItem style={{ fontSize: "2vw" }}>timestamp</TableHeaderItem>
    <TableHeaderItem style={{ fontSize: "2vw" }}>target</TableHeaderItem>
    <TableHeaderItem style={{ fontSize: "2vw" }}>return</TableHeaderItem>
    <TableHeaderItem style={{ fontSize: "2vw" }}>label</TableHeaderItem>
  </TableHeader>
  <TableBody>
    <TableRow>
      <TableItem style={{ fontSize: "2vw" }}>3</TableItem>
      <TableItem style={{ fontSize: "2vw" }}>2018-12-17 12:12:43.155227</TableItem>
      <TableItem style={{ fontSize: "2vw" }}>0.014105</TableItem>
      <TableItem style={{ fontSize: "2vw" }}>0.015244</TableItem>
      <TableItem style={{ fontSize: "2vw" }}>1</TableItem>
    </TableRow>
  </TableBody>
</Table>

---

# Labels of either "1" or "-1" indicate a trading opportunity.

---

# Labels of "1", buy low and sell high.

<Image style={{ height: "50vh" }} src={buySide} />

---

# Labels of "-1", sell high and buy low.

<Image style={{ height: "50vh" }} src={sellSide} />

---

# Labels of "-1" imply margin trading. Selling that which you do not have.

---

# For example, using Â¥100,000 as margin (collateral) to sell Â¥200,000.
## ãŸã¨ãˆã°ã€100,000å††ã‚’ãƒãƒ¼ã‚¸ãƒ³ï¼ˆæ‹…ä¿ï¼‰ã¨ã—ã¦ä½¿ç”¨ã—ã¦ã€200,000å††ã‚’è²©å£²ã—ã¾ã™ã€‚

---

# Labels of 0 suggest there was not enough volatility for trading to be worthwhile.

---

# In a recent <a href="https://time.com/5751190/investing-machine-learning-marcos-de-lopez-prado/">article in Time magazine</a>, Lopez de Prado states...

---

# ...ML should be used as a research tool, nad not as a forecasting tool.

---

# This precludes using Amazon Forecast.
##

---

# However, let's try anyway.
##

---

# Thatâ€™s all. Thanks for listening.
## ä»¥ä¸Šã§ã™ã€‚ã”æ¸…è´ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚
